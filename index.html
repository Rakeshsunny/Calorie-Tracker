<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <title>Mission 72 | Elite</title>

  <!-- Tailwind + Icons + Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icons/icon-192.png" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />

  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <!-- TOP: App Shell -->
  <div id="app">
    <!-- Scrollable content area -->
    <main id="scroll-area">

      <!-- VIEW: HOME -->
      <section id="view-home" class="view active-view">
        <header class="topbar">
          <div class="brand">
            <div class="brandIcon">
              <i class="ph-fill ph-rocket-launch"></i>
            </div>
            <div>
              <div class="brandKicker">Mission 72</div>
              <div class="brandTitle">Elite Tracker</div>
            </div>
          </div>

          <div class="topActions">
            <button class="iconBtn btn-press" id="sync-btn" title="Sync to Google Sheets" onclick="Sync.syncNow()">
              <i class="ph-bold ph-arrows-clockwise"></i>
            </button>
            <button class="iconBtn btn-press" title="Settings" onclick="UI.openSheet('settings')">
              <i class="ph ph-gear"></i>
            </button>
          </div>
        </header>

        <!-- HERO -->
        <section class="card hero">
          <div class="heroRow">
            <div>
              <div class="kicker">Remaining</div>
              <div class="heroBig" id="val-rem">0</div>

              <div class="chips">
                <span class="chip">Net: <b id="val-net">0</b></span>
                <span class="chip chipBlue">
                  Weight: <b id="header-weight">--</b> kg
                </span>
              </div>
            </div>

            <div class="ringWrap">
              <svg class="ring" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="40" class="ringTrack"></circle>
                <circle id="ring-progress" cx="50" cy="50" r="40" class="ringProg"></circle>
              </svg>
              <div class="ringText"><span id="val-pct">0%</span></div>
            </div>
          </div>

          <!-- Macros with progress bars -->
          <div class="macroGrid">
            <div class="macroBox">
              <div class="macroTop">
                <div class="macroLabel"><i class="ph-bold ph-fork-knife"></i> Protein</div>
                <div class="macroVal"><span id="curr-pro">0</span>/<span id="tgt-pro">0</span>g</div>
              </div>
              <div class="bar">
                <div id="bar-pro" class="barFill"></div>
              </div>
              <div class="macroPct"><span id="pct-pro">0</span>%</div>
            </div>

            <div class="macroBox">
              <div class="macroTop">
                <div class="macroLabel"><i class="ph-bold ph-bread"></i> Carbs</div>
                <div class="macroVal"><span id="curr-carb">0</span>/<span id="tgt-carb">0</span>g</div>
              </div>
              <div class="bar">
                <div id="bar-carb" class="barFill"></div>
              </div>
              <div class="macroPct"><span id="pct-carb">0</span>%</div>
            </div>

            <div class="macroBox">
              <div class="macroTop">
                <div class="macroLabel"><i class="ph-bold ph-drop-half"></i> Fat</div>
                <div class="macroVal"><span id="curr-fat">0</span>/<span id="tgt-fat">0</span>g</div>
              </div>
              <div class="bar">
                <div id="bar-fat" class="barFill"></div>
              </div>
              <div class="macroPct"><span id="pct-fat">0</span>%</div>
            </div>
          </div>
        </section>

        <!-- QUICK CARDS -->
        <section class="grid2">
          <button class="card mini btn-press" onclick="Data.addWater()">
            <div>
              <div class="kicker">Water</div>
              <div class="miniBig"><span id="val-water">0</span><span class="miniUnit">/3.0L</span></div>
            </div>
            <i class="ph-bold ph-drop miniIcon"></i>
          </button>

          <button class="card mini btn-press" onclick="UI.openSheet('exercise')">
            <div>
              <div class="kicker">Active Burn</div>
              <div class="miniBig plus">+ <span id="val-burned">0</span></div>
            </div>
            <i class="ph-bold ph-lightning miniIcon"></i>
          </button>
        </section>

        <!-- MEAL TABS -->
        <section class="tabs">
          <button id="btn-Breakfast" onclick="App.setMeal('Breakfast')">Breakfast</button>
          <button id="btn-Lunch" onclick="App.setMeal('Lunch')">Lunch</button>
          <button id="btn-Snack" onclick="App.setMeal('Snack')">Snack</button>
          <button id="btn-Dinner" onclick="App.setMeal('Dinner')">Dinner</button>
        </section>

        <!-- SEARCH -->
        <section class="card">
          <div class="searchWrap">
            <input id="search-input" type="text" placeholder="Search foods (egg, dal, roti...)" oninput="Foods.search()" />
            <i class="ph ph-magnifying-glass"></i>
          </div>

          <div class="searchActions">
            <button class="btn-press actionBtn" onclick="UI.openSheet('foodCreate')">
              <i class="ph-bold ph-plus"></i> Add Custom Food
            </button>
            <button class="btn-press actionBtn" onclick="UI.openSheet('weight')">
              <i class="ph-bold ph-scales"></i> Log Weight
            </button>
          </div>

          <div id="search-results" class="hidden mt-3 space-y-2"></div>
        </section>

        <!-- LOG LIST -->
        <section class="mt-4">
          <div class="sectionHead">
            <div>
              <div class="kicker" id="logMealTitle">Breakfast</div>
              <div class="sectionTitle">Today Log</div>
            </div>
            <button class="btn-press dangerBtn" onclick="Data.resetToday()">Reset</button>
          </div>
          <div id="log-list" class="space-y-2"></div>
        </section>
      </section>

      <!-- VIEW: TRENDS -->
      <section id="view-trends" class="view">
        <header class="viewHeader">
          <div>
            <div class="kicker">Trends</div>
            <div class="sectionTitle">Performance</div>
          </div>
        </header>

        <div class="segmented">
          <button id="trend-day" onclick="Trends.setMode('day')">Day</button>
          <button id="trend-week" onclick="Trends.setMode('week')">Week</button>
          <button id="trend-month" onclick="Trends.setMode('month')">Month</button>
        </div>

        <section class="card p-5">
          <div class="kicker">Calories (Net)</div>
          <div class="h-56 mt-3"><canvas id="chart-net"></canvas></div>
        </section>

        <section class="card p-5 mt-4">
          <div class="kicker">Macros</div>
          <div class="h-56 mt-3"><canvas id="chart-macros"></canvas></div>
        </section>

        <section class="card p-5 mt-4">
          <div class="kicker">Weight</div>
          <div class="h-56 mt-3"><canvas id="chart-weight"></canvas></div>
        </section>
      </section>

      <!-- VIEW: HISTORY (EDITABLE) -->
      <section id="view-history" class="view">
        <header class="viewHeader">
          <div>
            <div class="kicker">History</div>
            <div class="sectionTitle">Edit past days</div>
          </div>
        </header>

        <section class="card p-5">
          <div class="kicker">Pick a day</div>
          <div id="history-days" class="mt-3 grid grid-cols-7 gap-2"></div>
          <div class="muted mt-3 text-xs">Tap a date square to edit water/burn/logs. Long-press to delete a day.</div>
        </section>

        <section class="card p-5 mt-4 hidden" id="history-editor">
          <div class="flex items-center justify-between">
            <div>
              <div class="kicker">Editing</div>
              <div class="sectionTitle" id="history-date-title">YYYY-MM-DD</div>
            </div>
            <button class="btn-press actionBtn" onclick="UI.openSheet('historyDayEdit')">
              <i class="ph-bold ph-pencil"></i> Day settings
            </button>
          </div>

          <div class="mt-4 space-y-2" id="history-log-list"></div>
        </section>
      </section>

      <!-- VIEW: LIBRARY -->
      <section id="view-library" class="view">
        <header class="viewHeader">
          <div>
            <div class="kicker">Library</div>
            <div class="sectionTitle">Saved foods</div>
          </div>
        </header>

        <section class="card p-5">
          <div class="searchWrap">
            <input id="library-search" type="text" placeholder="Search saved foods..." oninput="Library.render()" />
            <i class="ph ph-magnifying-glass"></i>
          </div>
          <div class="muted text-xs mt-3">Save foods from search (‚òÖ). Tap an item to add to your current meal.</div>
        </section>

        <div id="library-list" class="mt-4 space-y-2"></div>
      </section>

    </main>

    <!-- Bottom nav -->
    <nav id="nav-bar">
      <button class="nav-btn active" onclick="UI.nav('home', this)">
        <i class="ph-fill ph-house"></i><span>Home</span>
      </button>
      <button class="nav-btn" onclick="UI.nav('trends', this)">
        <i class="ph-fill ph-chart-line-up"></i><span>Trends</span>
      </button>
      <button class="nav-btn" onclick="UI.nav('history', this)">
        <i class="ph-fill ph-calendar"></i><span>History</span>
      </button>
      <button class="nav-btn" onclick="UI.nav('library', this)">
        <i class="ph-fill ph-books"></i><span>Library</span>
      </button>
    </nav>
  </div>

  <!-- BACKDROP + SHEETS -->
  <div id="backdrop" class="sheet-backdrop" onclick="UI.closeAllSheets()"></div>

  <!-- SHEET: SETTINGS -->
  <section id="sheet-settings" class="sheet">
    <div class="sheetHead">
      <div>
        <div class="kicker">Settings</div>
        <div class="sheetTitle">Profile & Sync</div>
      </div>
      <button class="iconBtn btn-press" onclick="UI.closeAllSheets()"><i class="ph ph-x"></i></button>
    </div>

    <div class="mt-4 space-y-3">
      <div class="field">
        <label>Daily Calorie Goal</label>
        <input id="s-cal" type="number" placeholder="1650" />
      </div>

      <div class="grid grid-cols-3 gap-2">
        <div class="field">
          <label>Protein (g)</label>
          <input id="s-pro" type="number" placeholder="130" />
        </div>
        <div class="field">
          <label>Carbs (g)</label>
          <input id="s-carb" type="number" placeholder="170" />
        </div>
        <div class="field">
          <label>Fat (g)</label>
          <input id="s-fat" type="number" placeholder="55" />
        </div>
      </div>

      <div class="field">
        <label>Google Apps Script Web App URL</label>
        <input id="s-url" type="text" placeholder="https://script.google.com/macros/s/....../exec" />
      </div>

      <div class="field">
        <label>Sync Token (secret)</label>
        <input id="s-token" type="password" placeholder="Paste your secret token" />
        <div class="muted text-xs mt-1">This stays only in your browser localStorage.</div>
      </div>

      <button class="primaryBtn btn-press" onclick="Settings.save()">Save Settings</button>

      <div class="divider"></div>

      <button class="dangerWide btn-press" onclick="Data.resetAll()">Factory Reset (local)</button>
      <div class="muted text-xs mt-2">
        Reset clears browser data. It does not delete your Google Sheet.
      </div>
    </div>
  </section>

  <!-- SHEET: FOOD ADD -->
  <section id="sheet-food" class="sheet">
    <div class="sheetHead">
      <div>
        <div class="kicker" id="sheet-mode">Add</div>
        <div class="sheetTitle" id="sheet-name">Food</div>
      </div>
      <button class="iconBtn btn-press" onclick="UI.closeAllSheets()"><i class="ph ph-x"></i></button>
    </div>

    <div class="qtyRow mt-4">
      <button class="qtyBtn btn-press" onclick="Sheet.adj(-0.5)">‚àí</button>
      <div class="qtyVal" id="sheet-qty">1.0</div>
      <button class="qtyBtn btn-press" onclick="Sheet.adj(0.5)">+</button>
    </div>

    <div class="mt-4 bigKcal" id="sheet-total">0 kcal</div>

    <div class="mt-4 grid grid-cols-2 gap-2">
      <button class="actionBtn btn-press" onclick="Sheet.toggleFav()"><i class="ph-bold ph-star"></i> <span id="sheet-fav">Save</span></button>
      <button class="primaryBtn btn-press" onclick="Sheet.saveToDay()">Save to Day</button>
    </div>

    <button class="dangerWide btn-press mt-3 hidden" id="sheet-delete" onclick="Sheet.deleteLog()">Delete Log</button>
  </section>

  <!-- SHEET: CREATE CUSTOM FOOD -->
  <section id="sheet-foodCreate" class="sheet">
    <div class="sheetHead">
      <div>
        <div class="kicker">Custom</div>
        <div class="sheetTitle">Create food</div>
      </div>
      <button class="iconBtn btn-press" onclick="UI.closeAllSheets()"><i class="ph ph-x"></i></button>
    </div>

    <div class="mt-4 space-y-3">
      <div class="field"><label>Name</label><input id="c-name" placeholder="e.g., Homemade Upma" /></div>
      <div class="field"><label>Serving Unit</label><input id="c-unit" placeholder="e.g., 1 bowl" /></div>

      <div class="grid grid-cols-2 gap-2">
        <div class="field"><label>Calories</label><input id="c-kcal" type="number" placeholder="250" /></div>
        <div class="field"><label>Protein (g)</label><input id="c-pro" type="number" placeholder="10" /></div>
        <div class="field"><label>Carbs (g)</label><input id="c-carb" type="number" placeholder="40" /></div>
        <div class="field"><label>Fat (g)</label><input id="c-fat" type="number" placeholder="8" /></div>
      </div>

      <button class="primaryBtn btn-press" onclick="Foods.createCustom()">Save Custom Food</button>
    </div>
  </section>

  <!-- SHEET: EXERCISE -->
  <section id="sheet-exercise" class="sheet">
    <div class="sheetHead">
      <div>
        <div class="kicker">Active</div>
        <div class="sheetTitle">Add burn</div>
      </div>
      <button class="iconBtn btn-press" onclick="UI.closeAllSheets()"><i class="ph ph-x"></i></button>
    </div>

    <div class="mt-4 grid grid-cols-2 gap-2">
      <button class="card mini btn-press" onclick="Data.addBurn('Cricket', 450)">üèè Cricket <span class="muted text-xs block">+450</span></button>
      <button class="card mini btn-press" onclick="Data.addBurn('Gym', 300)">üèãÔ∏è Gym <span class="muted text-xs block">+300</span></button>
      <button class="card mini btn-press" onclick="Data.addBurn('Walk', 200)">üö∂ Walk <span class="muted text-xs block">+200</span></button>
      <button class="card mini btn-press" onclick="Data.addBurn('Run', 400)">üèÉ Run <span class="muted text-xs block">+400</span></button>
    </div>
  </section>

  <!-- SHEET: WEIGHT -->
  <section id="sheet-weight" class="sheet">
    <div class="sheetHead">
      <div>
        <div class="kicker">Weight</div>
        <div class="sheetTitle">Log weight</div>
      </div>
      <button class="iconBtn btn-press" onclick="UI.closeAllSheets()"><i class="ph ph-x"></i></button>
    </div>

    <div class="mt-4 space-y-3">
      <div class="field"><label>Weight (kg)</label><input id="w-val" type="number" step="0.1" placeholder="e.g., 80.0" /></div>
      <button class="primaryBtn btn-press" onclick="Data.saveWeight()">Save Weight</button>
    </div>
  </section>

  <!-- SHEET: EDIT HISTORY DAY (water/burn) -->
  <section id="sheet-historyDayEdit" class="sheet">
    <div class="sheetHead">
      <div>
        <div class="kicker">History</div>
        <div class="sheetTitle">Edit Day</div>
      </div>
      <button class="iconBtn btn-press" onclick="UI.closeAllSheets()"><i class="ph ph-x"></i></button>
    </div>

    <div class="mt-4 space-y-3">
      <div class="field">
        <label>Date</label>
        <input id="hd-date" disabled />
      </div>

      <div class="grid grid-cols-2 gap-2">
        <div class="field">
          <label>Water steps (0.25L each)</label>
          <input id="hd-water" type="number" />
        </div>
        <div class="field">
          <label>Burn (kcal)</label>
          <input id="hd-burn" type="number" />
        </div>
      </div>

      <button class="primaryBtn btn-press" onclick="History.saveDayEdits()">Save Day</button>
      <button class="dangerWide btn-press" onclick="History.deleteDay()">Delete This Day</button>
    </div>
  </section>

  <!-- SHEET: EDIT HISTORY LOG (kcal/macros/qty) -->
  <section id="sheet-historyLogEdit" class="sheet">
    <div class="sheetHead">
      <div>
        <div class="kicker">History</div>
        <div class="sheetTitle">Edit Log</div>
      </div>
      <button class="iconBtn btn-press" onclick="UI.closeAllSheets()"><i class="ph ph-x"></i></button>
    </div>

    <div class="mt-4 space-y-3">
      <div class="field"><label>Name</label><input id="hl-name" /></div>
      <div class="grid grid-cols-2 gap-2">
        <div class="field"><label>Qty</label><input id="hl-qty" type="number" step="0.25" /></div>
        <div class="field"><label>Calories</label><input id="hl-kcal" type="number" /></div>
        <div class="field"><label>Protein</label><input id="hl-pro" type="number" /></div>
        <div class="field"><label>Carbs</label><input id="hl-carb" type="number" /></div>
        <div class="field"><label>Fat</label><input id="hl-fat" type="number" /></div>
      </div>
      <button class="primaryBtn btn-press" onclick="History.saveLogEdits()">Save Log</button>
      <button class="dangerWide btn-press" onclick="History.deleteLog()">Delete Log</button>
    </div>
  </section>

  <script src="./app.js"></script>
  <script>
    // Service worker for offline-first + installable PWA
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => navigator.serviceWorker.register("./sw.js"));
    }
  </script>
</body>
</html>
